#bot.py

'''
This is the aacf deploy of ticket-sniper 1.0, developed by noach.
'''
from textAnalysis import sniper

import discord
import os
import numpy as np
from datetime import date,timedelta
import csv

from dotenv import load_dotenv


def checkYoungMember(dateJoined, checkLength):
    #testDate = datetime.now() + timedelta(days = checkLength)
    #if dateJoined >= testDate:
        #return true

    return True

load_dotenv()
TOKEN = os.getenv('DISCORD_TOKEN')
GUILD = os.getenv('DISCORD_GUILD')

intents = discord.Intents.default()
intents.message_content = True #note that this also marked in the discord application manager (privaliged intent)
intents.messages = True

client = discord.Client(intents = intents)

@client.event
async def on_ready():
    for guild in client.guilds:
        if guild.name == GUILD:
            break

    print(
        f'{client.user} is connected to the following guild:\n'
        f'{guild.name}(id: {guild.id})'
    )

@client.event
async def on_message(message):

    channelIDsToListen = [1311151950087065603] #fixme ~ channel ids

    if message.channel.id in channelIDsToListen:
        verify = message.author 

        if checkYoungMember(verify.joined_at,7):
           # print(message.content)

            if sniper.snipe(message.content):
                print("hello jits")
                await message.delete()

    
client.run(TOKEN)